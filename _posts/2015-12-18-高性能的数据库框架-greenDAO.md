---
layout: post
title: '高性能的数据库框架-greenDAO'
tags: [code]
---
### 关于greenDAO

greenDAO是一个将对象映射到SQLite数据库中的轻量且快速的ORM解决方案，它性能是目前最好的，且内存开销小。其他框架因为注解的原因，性能不如greenDAO。

### 使用greenDAO

一.在Android工程中配置GreenDao Generator

在main目录下新建一个目录java-gen,用于存放greenDAO自动生成的Bean、Dao、DaoMaster、DaoSession

![](http://www.jcodecraeer.com/uploads/20150727/1437967488134646.png)

![](http://www.jcodecraeer.com/uploads/20150727/1437967488110019.png)

配置build.gradle

![](http://www.jcodecraeer.com/uploads/20150727/1437967489561349.png)


在Android里面添加如下代码

	sourceSets{
        main{
            java.srcDirs =['src/main/java','src/main/java-gen']
        }
    }

在dependencies里面添加如下代码

	compile 'de.greenrobot:greendao:1.3.7'

二.新建GreenDao Generator模块，新建Module

![](http://www.jcodecraeer.com/uploads/20150727/1437967489104631.png)

![](http://www.jcodecraeer.com/uploads/20150727/1437967490104007.png)

![](http://www.jcodecraeer.com/uploads/20150727/1437967490123204.png)

配置daoexamplegenerator 工程的build.gradle,添加dependencies

![](http://www.jcodecraeer.com/uploads/20150727/1437967491833654.png)

编写自动生成的DaoGenerator类，我的是MyDaoGenerator，这个名字可以自己起，在创建的时候，最好不要用DaoGenerator这个名字，会有冲突。

	public class MyDaoGenerator {

    public static void main(String[] args)throws Exception{
        //两个参数分别代表：数据库版本号，自动代码生成所在的包名
        Schema schema = new Schema(1,"com.tyq.greendao");

        addData(schema);

        //使用DaoGenerator的generateAll方法自动生成代码，会放入第二个参数的路径中
        new DaoGenerator().generateAll(schema,"/Android Sample/AccountBook/app/src/main/java-gen");

    }

    private static void addData(Schema schema){
        //一个实体类就代表一张表，此处表名为Person
        Entity person = schema.addEntity("Person");

        //生成表的字段
        person.addIdProperty();
        person.addStringProperty("name");
        person.addStringProperty("money");
    }
	}

经过上面的步骤，你可以执行generator工程，如果一切都对了，会在java-gen里生成四个类文件，并且控制台会看到如下

![](http://www.jcodecraeer.com/uploads/20150727/1437967491555755.png)

下面你就可以在自己的工程中使用greenDao了，在使用GreenDao的时候，你需要先做一些初始化的操作。

	private void setUpDatabase() {
        //通过DaoMaster的内部类DevOpenHelper，可以获得一个SqliteOpenHelper对象
        //注意：默认的DaoMaster.DevOpenHelper会在数据库升级时，删除所有表
        DaoMaster.DevOpenHelper helper = new DaoMaster.DevOpenHelper(this, "person-db", null);

        db = helper.getWritableDatabase();

        daoMaster = new DaoMaster(db);
        daoSession = daoMaster.newSession();

    }

    private PersonDao getPersonDao() {
        return daoSession.getPersonDao();
    }

- DaoMaster:

daomaster以一定模式持有数据库对象(SQLiteDatabase)，并管理一些Dao类，有一个静态方法创建和drop数据库表，它的内部类OpenHelper和DevOpenHelper是SQLiteOpenHelper的实现类，用于创建SQLite数据库的模式。

- DaoSession：

管理指定模式下所有可用的DAO对象，你可以通过某个get方法获取到。DaoSession提供一些通用的持久化方法，比如对实体进行插入，加载，更新，刷新和删除。


在其他地方调用getPersonDao()就可以使用增删改查了。

	getPersonDao().insert(person);//插入
	getPersonDao().deleteByKey(id);//删除
	list = getPersonDao().queryBuilder()
	.where(PersonDao.Properties.Name.like("%" + et_search_name.getText().toString() + "%"))
	.list();//查询

查询需要注意，返回的是List，我在适配数据的时候，自己写了一个适配器，把list传过去，然后设置。

模糊查询跟SQLite一样，可以加 % 控制，调用like()方法。

### 例子

我第一个写的小App就是用Sqlite简单的增删改查，非常简单，最近学习了GreenDao，就把他重写了一遍，放在GitHub上了，有兴趣的可以去看看。

参考文章：

- [ORM 框架之 greenDAO 使用心得](http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0727/3223.html)
- [GreenDao官方文档翻译](http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1127/2069.html)
